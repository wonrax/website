---
import type { Heading } from "@/layouts/BlogPostLayout.astro";
import HeadingElement from "./HeadingElement.astro";

type Props = {
  headings: Heading[];
};

// Shift the levels to base 1 by finding the smallest depth
const minDepth = Math.min(...Astro.props.headings.map((h) => h.depth));
Astro.props.headings.forEach((h) => (h.depth -= minDepth - 1));

const headings: Heading[] = Astro.props.headings;

export type NestedHeading = {
  text: string;
  slug: string;
  children: NestedHeading[];
};

// filter headings to only include level 1 and 2
const filteredHeadings = headings.filter((h) => h.depth <= 2);

// convert to nested structure
const nestedHeadings: NestedHeading[] = [];
for (const h of filteredHeadings) {
  if (h.depth === 1) {
    nestedHeadings.push({
      text: h.text,
      slug: h.slug,
      children: [],
    });
  } else if (h.depth === 2) {
    nestedHeadings[nestedHeadings.length - 1].children.push({
      text: h.text,
      slug: h.slug,
      children: [],
    });
  }
}
---

<ol class="table-of-content level-1">
  {
    nestedHeadings.map((heading) => (
      <li>
        <HeadingElement heading={heading} depth={2} />
      </li>
    ))
  }
</ol>

<style lang="scss" is:global>
  .table-of-content {
    margin: 0;
    padding-inline-start: 1em;

    ul {
      padding-inline-start: 0;
      list-style-type: none;
    }

    & > li {
      margin-top: 8px;
    }

    li::marker,
    a,
    a:visited {
      color: #333;
      font-size: 14px;
    }

    li.active > a {
      font-weight: 500;
      color: #dd0000;
      box-shadow: inset 0 -2px 0 0 #dd0000;
    }

    a {
      display: block;
      padding: 4px;
    }
  }

  .level-1 > li > a {
    font-weight: 500;
  }

  .level-2 > li > a {
    font-weight: 400;
  }
</style>
