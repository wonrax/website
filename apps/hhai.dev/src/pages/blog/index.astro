---
import BlogRouteLayout from "@/layouts/BlogRouteLayout.astro";
import type { Frontmatter } from "@/layouts/BlogPostLayout.astro";

const allPosts = await Astro.glob<Frontmatter>("./**/*.mdx");
---

<BlogRouteLayout>
  <title slot="head">Blog</title>
  <meta slot="head" name="description" content="hhai.dev blog index" />
  <main class="blog-main">
    <p style={{ color: "var(--text-body-light)" }}>Newest first</p>
    <ul class="article-list">
      {
        allPosts
          .filter(
            (post) =>
              process.env.NODE_ENV != "production" ||
              (!post.frontmatter.isDraft && !post.frontmatter.hidden),
          )
          .map((post) => (
            <li
              class={`article-entry${
                post.frontmatter.isDraft || post.frontmatter.hidden
                  ? " hidden"
                  : ""
              }`}
            >
              <div>
                <div
                  style={{
                    display: "flex",
                    flexDirection: "row",
                    alignItems: "start",
                    gap: "12px",
                  }}
                >
                  <a href={post.url}>{post.frontmatter.title}</a>
                  <hr
                    style={{
                      height: "1px",
                      flex: 1,
                      backgroundColor: "var(--bg-additive-medium)",
                      border: "none",
                      margin: "0.6em 0 0 0",
                    }}
                  />
                  <p class="article-date">
                    {new Date(post.frontmatter.published).toLocaleDateString(
                      "en-UK",
                      {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                      },
                    )}
                  </p>
                </div>
              </div>
              <p class="article-description">{post.frontmatter.description}</p>
            </li>
          ))
      }
    </ul>
  </main>
</BlogRouteLayout>

<style lang="scss" is:global>
  .blog-main {
    margin: 0 auto;
    max-width: 100%;
    width: 700px;
    padding: 0 32px;
    box-sizing: border-box;

    .article-list {
      list-style-type: decimal;
      margin-top: 32px;
      padding-inline-start: 0;

      .article-entry {
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        max-width: 700px;

        &.hidden {
          a {
            color: var(--text-body-light);
          }
        }

        & > div {
          width: 100%;
        }

        a {
          font-weight: var(--font-weight-medium);
          font-size: 16px;
          letter-spacing: -0.01em;
          line-height: 1.45em;
        }

        p {
          margin: 2px 0;
        }

        .article-date {
          color: var(--text-body-light);
          font-size: 14px;
          white-space: nowrap;
          // TODO relayout to display all instead of doing this
          flex-shrink: 0;
        }

        .article-description {
          color: var(--text-body-medium);
          font-size: 16px;
          line-height: 1.45em;
        }
      }
    }
    @media (min-width: 1280px) {
      width: 1004px;
    }

    @media (min-width: 800px) {
      padding: 0;
    }
  }
</style>
